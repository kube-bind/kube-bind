<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">

    <title>Modules - Kube Bind</title>
    <style>
      body {
        background: #f8f9fa;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        color: #495057;
      }
      
      .page-header {
        text-align: center;
        margin: 2rem 0;
      }
      
      .page-header h2 {
        color: #343a40;
        font-weight: 400;
        font-size: 1.75rem;
        margin-bottom: 0.25rem;
      }
      
      .page-header p {
        color: #6c757d;
        font-size: 0.9rem;
        margin: 0;
      }
      
      .module-card {
        border: 1px solid #dee2e6;
        border-radius: 6px;
        background: white;
        transition: border-color 0.15s ease-in-out;
        margin-bottom: 1rem;
      }
      
      .module-card:hover {
        border-color: #007bff;
      }
      
      .module-card .card-header {
        background: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        padding: 0.75rem 1rem;
      }
      
      .module-card .card-header h5 {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 500;
        color: #343a40;
      }
      
      .list-group-item {
        border: none;
        border-bottom: 1px solid #f1f3f4;
        padding: 0.75rem 1rem;
        font-size: 0.875rem;
      }
      
      .list-group-item:last-child {
        border-bottom: none;
      }
      
      .item-tag {
        display: inline-block;
        background: #e9ecef;
        color: #495057;
        padding: 0.125rem 0.375rem;
        margin: 0.125rem 0.125rem 0.125rem 0;
        border-radius: 3px;
        font-size: 0.75rem;
        font-family: 'Monaco', 'Menlo', monospace;
      }
      
      .details-btn {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 3px;
        color: #6c757d;
        border: 1px solid #dee2e6;
        background: white;
      }
      
      .details-btn:hover {
        background: #f8f9fa;
        color: #495057;
        border-color: #adb5bd;
      }
      
      .bind-btn {
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 0.5rem 1.25rem;
        font-size: 0.875rem;
        font-weight: 400;
        text-decoration: none;
      }
      
      .bind-btn:hover {
        background: #0056b3;
        color: white;
        text-decoration: none;
      }
      
      .detail-card {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        font-size: 0.8rem;
      }
      
      .scope-badge {
        background: #6c757d;
        color: white;
        padding: 0.125rem 0.375rem;
        border-radius: 3px;
        font-size: 0.7rem;
        font-weight: normal;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="page-header">
        <h2>Available Modules</h2>
        <p>Select a module to bind its resources and permissions</p>
      </div>
      
      <div class="row">
        {{range $moduleIdx, $schema := .Schemas}}
        <div class="col-lg-6 col-md-12 mb-3">
          <div class="card module-card">
            <div class="card-header">
              <h5>{{$schema.Name}}</h5>
              {{if $schema.Description}}<small class="text-muted">{{$schema.Description}}</small>{{end}}
            </div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item">
                <strong>Scope:</strong> <span class="scope-badge">{{$schema.Scope}}</span>
              </li>
              <li class="list-group-item">
                <strong>Resources ({{len $schema.Resources}}):</strong>
                <div class="mt-1">
                {{range $schema.Resources}}
                <span class="item-tag">{{.Resource}}.{{.Group}}</span>
                {{end}}
                </div>
              </li>
              {{if $schema.PermissionClaims}}
              <li class="list-group-item">
                <strong>Permissions ({{len $schema.PermissionClaims}}):</strong>
                {{range $i, $claim := $schema.PermissionClaims}}
                <div class="mt-1">
                  <span class="item-tag">
                    {{$claim.Resource}}{{if $claim.Group}}.{{$claim.Group}}{{end}}
                    {{if $claim.Selector.NamedResources}} ({{len $claim.Selector.NamedResources}}){{end}}
                    {{if $claim.Selector.LabelSelector}} (labels){{end}}
                  </span>
                  {{if or $claim.Selector.NamedResources $claim.Selector.LabelSelector}}
                  <br>
                  <a class="btn details-btn mt-1" data-toggle="collapse" href="#claim-{{$moduleIdx}}-{{$i}}" role="button" aria-expanded="false">
                    Details
                  </a>
                  <div class="collapse mt-2" id="claim-{{$moduleIdx}}-{{$i}}">
                    {{if $claim.Selector.NamedResources}}
                    <div class="detail-card p-2 mb-2">
                      <strong>Named:</strong>
                      {{range $claim.Selector.NamedResources}}
                      <br><small>{{.Name}}{{if .Namespace}} ({{.Namespace}}){{end}}</small>
                      {{end}}
                    </div>
                    {{end}}
                    {{if $claim.Selector.LabelSelector}}
                    <div class="detail-card p-2">
                      <strong>Labels:</strong>
                      {{if $claim.Selector.LabelSelector.MatchLabels}}
                      {{range $key, $value := $claim.Selector.LabelSelector.MatchLabels}}
                      <br><small>{{$key}}: {{$value}}</small>
                      {{end}}
                      {{end}}
                      {{if $claim.Selector.LabelSelector.MatchExpressions}}
                      {{range $claim.Selector.LabelSelector.MatchExpressions}}
                      <br><small>{{.Key}} {{.Operator}} {{range $idx, $val := .Values}}{{if $idx}}, {{end}}{{$val}}{{end}}</small>
                      {{end}}
                      {{end}}
                    </div>
                    {{end}}
                  </div>
                  {{end}}
                </div>
                {{end}}
              </li>
              {{end}}
              {{if $schema.Namespaces}}
              <li class="list-group-item">
                <strong>Namespaces ({{len $schema.Namespaces}}):</strong>
                <div class="mt-1">
                {{range $schema.Namespaces}}
                <span class="item-tag">{{.Name}}</span>
                {{end}}
                </div>
              </li>
              {{end}}
            </ul>
            <div class="card-body">
              <a href="{{if $.Cluster}}/clusters/{{$.Cluster}}{{end}}/bind?s={{$schema.SessionID}}&template={{$schema.Name}}" class="btn bind-btn {{$schema.Name}}">
                Bind Module
              </a>
            </div>
          </div>
        </div>
        {{end}}
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>
